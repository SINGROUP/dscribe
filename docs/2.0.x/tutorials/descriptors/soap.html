<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smooth Overlap of Atomic Positions &mdash; DScribe 2.0.x documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="../../_static/js/versions.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Many-body Tensor Representation" href="mbtr.html" />
    <link rel="prev" title="Atom-centered Symmetry Functions" href="acsf.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0.x
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basics">Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#descriptors">Descriptors</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="coulomb_matrix.html">Coulomb Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="sine_matrix.html">Sine matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="ewald_sum_matrix.html">Ewald sum matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="acsf.html">Atom-centered Symmetry Functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Smooth Overlap of Atomic Positions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creation">Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mbtr.html">Many-body Tensor Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="lmbtr.html">Local Many-body Tensor Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="valleoganov.html">Valle-Oganov descriptor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#machine-learning">Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#visualization">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#similarity-analysis">Similarity Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing DScribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DScribe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
      <li>Smooth Overlap of Atomic Positions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/descriptors/soap.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="smooth-overlap-of-atomic-positions">
<h1>Smooth Overlap of Atomic Positions<a class="headerlink" href="#smooth-overlap-of-atomic-positions" title="Permalink to this heading"></a></h1>
<p>Smooth Overlap of Atomic Positions (SOAP) is a descriptor that encodes regions
of atomic geometries by using a local expansion of a gaussian smeared atomic
density with orthonormal functions based on spherical harmonics and radial
basis functions.</p>
<p>The SOAP output from DScribe is the partial power spectrum vector
<span class="math notranslate nohighlight">\(\mathbf{p}\)</span>, where the elements are defined as <span id="id1">[<a class="reference internal" href="#id8" title="Sandip De, Albert P. Bartók, Gábor Csányi, and Michele Ceriotti. Comparing molecules and solids across structural and alchemical space. Physical Chemistry Chemical Physics, 18(20):13754–13769, 2016. doi:10.1039/c6cp00415f.">1</a>]</span></p>
<div class="math notranslate nohighlight">
\[p^{Z_1 Z_2}_{n n' l} = \pi \sqrt{\frac{8}{2l+1}}\sum_m {c^{Z_1}_{n l m}}^*c^{Z_2}_{n' l m}\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(n'\)</span> are indices for the different radial basis
functions up to <span class="math notranslate nohighlight">\(n_\mathrm{max}\)</span>, <span class="math notranslate nohighlight">\(l\)</span> is the angular degree of the
spherical harmonics up to <span class="math notranslate nohighlight">\(l_\mathrm{max}\)</span> and <span class="math notranslate nohighlight">\(Z_1\)</span> and <span class="math notranslate nohighlight">\(Z_2\)</span>
are atomic species.</p>
<p>The coefficients <span class="math notranslate nohighlight">\(c^Z_{nlm}\)</span> are defined as the following inner
products:</p>
<div class="math notranslate nohighlight">
\[c^Z_{nlm} =\iiint_{\mathcal{R}^3}\mathrm{d}V g_{n}(r)Y_{lm}(\theta, \phi)\rho^Z(\mathbf{r}).\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho^Z(\mathbf{r})\)</span> is the gaussian smoothed atomic density for
atoms with atomic number <span class="math notranslate nohighlight">\(Z\)</span> defined as</p>
<div class="math notranslate nohighlight">
\[\rho^Z(\mathbf{r}) = \sum_i^{\lvert Z_i \rvert} e^{-1/2\sigma^2 \lvert \mathbf{r} - \mathbf{R}_i \rvert^2}\]</div>
<p><span class="math notranslate nohighlight">\(Y_{lm}(\theta, \phi)\)</span> are the real spherical harmonics, and
<span class="math notranslate nohighlight">\(g_{n}(r)\)</span> is the radial basis function.</p>
<p>For the radial degree of freedom the selection of the basis function
<span class="math notranslate nohighlight">\(g_{n}(r)\)</span> is not as trivial and multiple approaches may be used. By
default the DScribe implementation uses spherical gaussian type orbitals as
radial basis functions <span id="id2">[<a class="reference internal" href="#id9" title="Marc O J Jäger, Eiaki V Morooka, Filippo Federici Canova, Lauri Himanen, and Adam S Foster. Machine learning hydrogen adsorption on nanoclusters through structural descriptors. npj Computational Materials, 2018. doi:10.1038/s41524-018-0096-5.">2</a>]</span>, as they allow much faster analytic
computation. We however also include the possibility of using the original
polynomial radial basis set <span id="id3">[<a class="reference internal" href="#id7" title="Albert P. Bartók, Risi Kondor, and Gábor Csányi. On representing chemical environments. Physical Review B - Condensed Matter and Materials Physics, 87(18):1–16, 2013. doi:10.1103/PhysRevB.87.184115.">3</a>]</span>.</p>
<p>The spherical harmonics definition used by DScribe is based on <a class="reference external" href="https://en.wikipedia.org/wiki/Spherical_harmonics#Real_form">real (tesseral)
spherical harmonics</a>. This real form
spans the same space as the complex version, and is defined as a linear
combination of the complex basis. As the atomic density is a real-valued
quantity (no imaginary part) it is natural and computationally easier to use
this form that does not require complex algebra.</p>
<p>The SOAP kernel <span id="id4">[<a class="reference internal" href="#id7" title="Albert P. Bartók, Risi Kondor, and Gábor Csányi. On representing chemical environments. Physical Review B - Condensed Matter and Materials Physics, 87(18):1–16, 2013. doi:10.1103/PhysRevB.87.184115.">3</a>]</span> between two atomic environments can be retrieved
as a normalized polynomial kernel of the partial powers spectrums:</p>
<div class="math notranslate nohighlight">
\[K^\mathrm{SOAP}(\mathbf{p}, \mathbf{p'}) = \left( \frac{\mathbf{p} \cdot \mathbf{p'}}{\sqrt{\mathbf{p} \cdot \mathbf{p}~\mathbf{p'} \cdot \mathbf{p'}}}\right)^{\xi}\]</div>
<p>Although this is the original similarity definition, nothing in practice
prevents the usage of the output in non-kernel based methods or with other
kernel definitions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that by default the SOAP output by DScribe only contains unique
terms, i.e. some terms that would be repeated multiple times due to symmetry
are left out. In order to <em>exactly</em> match the original SOAP kernel
definition, you have to double the weight of the terms which have a
symmetric counter part in <span class="math notranslate nohighlight">\(\mathbf{p}\)</span>.</p>
</div>
<p>The partial SOAP spectrum ensures stratification of the output by species and
also provides information about cross-species interaction. See the
<a class="reference internal" href="../../doc/dscribe.descriptors.html#dscribe.descriptors.soap.SOAP.get_location" title="dscribe.descriptors.soap.SOAP.get_location"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_location()</span></code></a> method for a way of easily accessing parts of the
output that correspond to a particular species combination. In pseudo-code the
ordering of the output vector is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for Z in atomic numbers in increasing order:
   for Z&#39; in atomic numbers in increasing order:
      for l in range(l_max+1):
         for n in range(n_max):
            for n&#39; in range(n_max):
               if (n&#39;, Z&#39;) &gt;= (n, Z):
                  append p(\chi)^{Z Z&#39;}_{n n&#39; l}` to output
</pre></div>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading"></a></h2>
<p>Instantiating the object that is used to create SOAP can be done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dscribe.descriptors</span> <span class="kn">import</span> <span class="n">SOAP</span>

<span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">]</span>
<span class="n">r_cut</span> <span class="o">=</span> <span class="mf">6.0</span>
<span class="n">n_max</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">l_max</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># Setting up the SOAP descriptor</span>
<span class="n">soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span>
    <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
    <span class="n">periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span>
    <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">l_max</span><span class="o">=</span><span class="n">l_max</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The constructor takes the following parameters:</p>
<dl class="py method">
<dt class="sig sig-object py" id="dscribe.descriptors.soap.SOAP.__init__">
<span class="sig-prename descclassname"><span class="pre">SOAP.</span></span><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r_cut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rbf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crossover</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">average</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'off'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">species</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periodic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float64'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dscribe/descriptors/soap.html#SOAP.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dscribe.descriptors.soap.SOAP.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r_cut</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – A cutoff for local region in angstroms. Should be
bigger than 1 angstrom for the gto-basis.</p></li>
<li><p><strong>n_max</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – The number of radial basis functions.</p></li>
<li><p><strong>l_max</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – The maximum degree of spherical harmonics.</p></li>
<li><p><strong>sigma</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a>) – The standard deviation of the gaussians used to expand the
atomic density.</p></li>
<li><p><strong>rbf</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – <p>The radial basis functions to use. The available options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;gto&quot;</span></code>: Spherical gaussian type orbitals defined as <span class="math notranslate nohighlight">\(g_{nl}(r) = \sum_{n'=1}^{n_\mathrm{max}}\,\beta_{nn'l} r^l e^{-\alpha_{n'l}r^2}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;polynomial&quot;</span></code>: Polynomial basis defined as <span class="math notranslate nohighlight">\(g_{n}(r) = \sum_{n'=1}^{n_\mathrm{max}}\,\beta_{nn'} (r-r_\mathrm{cut})^{n'+2}\)</span></p></li>
</ul>
</p></li>
<li><p><strong>weighting</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a>) – <p>Contains the options which control the
weighting of the atomic density. Leave unspecified if
you do not wish to apply any weighting. The dictionary may
contain the following entries:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>: The weighting function to use. The
following are currently supported:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;poly&quot;</span></code>: <span class="math notranslate nohighlight">\(w(r) = \left\{ \begin{array}{ll} c(1 + 2 (\frac{r}{r_0})^{3} -3 (\frac{r}{r_0})^{2}))^{m}, \ \text{for}\ r \leq r_0\\ 0, \ \text{for}\ r &gt; r_0 \end{array}\right.\)</span></p>
<p>This function goes exactly to zero at <span class="math notranslate nohighlight">\(r=r_0\)</span>. If
you do not explicitly provide <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> in the
constructor, <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> is automatically set to <code class="docutils literal notranslate"><span class="pre">r0</span></code>.
You can provide the parameters <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">m</span></code> and <code class="docutils literal notranslate"><span class="pre">r0</span></code> as
additional dictionary items.</p>
<dl class="simple">
<dt>For reference see:</dt><dd><p>”Caro, M. (2019). Optimizing many-body atomic
descriptors for enhanced computational performance of
machine learning based interatomic potentials.  Phys.
Rev. B, 100, 024112.”</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;pow&quot;</span></code>: <span class="math notranslate nohighlight">\(w(r) = \frac{c}{d + (\frac{r}{r_0})^{m}}\)</span></p>
<p>If you do not explicitly provide <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> in the
constructor, <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> will be set as the value at which
this function decays to the value given by the
<code class="docutils literal notranslate"><span class="pre">threshold</span></code> entry in the weighting dictionary (defaults
to 1e-2), You can provide the parameters <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code>,
<code class="docutils literal notranslate"><span class="pre">m</span></code>, <code class="docutils literal notranslate"><span class="pre">r0</span></code> and <code class="docutils literal notranslate"><span class="pre">threshold</span></code> as additional dictionary
items.</p>
<dl class="simple">
<dt>For reference see:</dt><dd><p>”Willatt, M., Musil, F., &amp; Ceriotti, M. (2018).
Feature optimization for atomistic machine learning
yields a data-driven construction of the periodic
table of the elements.  Phys. Chem. Chem. Phys., 20,
29661-29668.
“</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;exp&quot;</span></code>: <span class="math notranslate nohighlight">\(w(r) = \frac{c}{d + e^{-r/r_0}}\)</span></p>
<p>If you do not explicitly provide <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> in the
constructor, <code class="docutils literal notranslate"><span class="pre">r_cut</span></code> will be set as the value at which
this function decays to the value given by the
<code class="docutils literal notranslate"><span class="pre">threshold</span></code> entry in the weighting dictionary (defaults
to 1e-2), You can provide the parameters <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code>,
<code class="docutils literal notranslate"><span class="pre">r0</span></code> and <code class="docutils literal notranslate"><span class="pre">threshold</span></code> as additional dictionary items.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;w0&quot;</span></code>: Optional weight for atoms that are directly on top
of a requested center. Setting this value to zero essentially
hides the central atoms from the output. If a weighting
function is also specified, this constant will override it
for the central atoms.</p></li>
</ul>
</p></li>
<li><p><strong>crossover</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Determines if crossover of atomic types should
be included in the power spectrum. If enabled, the power
spectrum is calculated over all unique species combinations Z
and Z’. If disabled, the power spectrum does not contain
cross-species information and is only run over each unique
species Z. Turned on by default to correspond to the original
definition</p></li>
<li><p><strong>average</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – <p>The averaging mode over the centers of interest.
Valid options are:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;off&quot;</span></code>: No averaging.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;inner&quot;</span></code>: Averaging over sites before summing up the magnetic quantum numbers: <span class="math notranslate nohighlight">\(p_{nn'l}^{Z_1,Z_2} \sim \sum_m (\frac{1}{n} \sum_i c_{nlm}^{i, Z_1})^{*} (\frac{1}{n} \sum_i c_{n'lm}^{i, Z_2})\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;outer&quot;</span></code>: Averaging over the power spectrum of different sites: <span class="math notranslate nohighlight">\(p_{nn'l}^{Z_1,Z_2} \sim \frac{1}{n} \sum_i \sum_m (c_{nlm}^{i, Z_1})^{*} (c_{n'lm}^{i, Z_2})\)</span></p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>species</strong> (<em>iterable</em>) – The chemical species as a list of atomic
numbers or as a list of chemical symbols. Notice that this is not
the atomic numbers that are present for an individual system, but
should contain all the elements that are ever going to be
encountered when creating the descriptors for a set of systems.
Keeping the number of chemical species as low as possible is
preferable.</p></li>
<li><p><strong>periodic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Set to True if you want the descriptor output to
respect the periodicity of the atomic systems (see the
pbc-parameter in the constructor of ase.Atoms).</p></li>
<li><p><strong>sparse</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Whether the output should be a sparse matrix or a
dense numpy array.</p></li>
<li><p><strong>dtype</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – <p>The data type of the output. Valid options are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;float32&quot;</span></code>: Single precision floating point numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;float64&quot;</span></code>: Double precision floating point numbers.</p></li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Increasing the arguments <em>nmax</em> and <em>lmax</em> makes SOAP more accurate but also
increases the number of features.</p>
</div>
<div class="section" id="creation">
<h2>Creation<a class="headerlink" href="#creation" title="Permalink to this heading"></a></h2>
<p>After SOAP has been set up, it may be used on atomic structures with the
<a class="reference internal" href="../../doc/dscribe.descriptors.html#dscribe.descriptors.soap.SOAP.create" title="dscribe.descriptors.soap.SOAP.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a>-method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">molecule</span>

<span class="c1"># Molecule created as an ASE.Atoms</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;H2O&quot;</span><span class="p">)</span>

<span class="c1"># Create SOAP output for the system</span>
<span class="n">soap_water</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">soap_water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">soap_water</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Create output for multiple system</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;H2O&quot;</span><span class="p">),</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;NO2&quot;</span><span class="p">),</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;CO2&quot;</span><span class="p">)]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="n">coulomb_matrices</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>            <span class="c1"># Serial</span>
<span class="n">coulomb_matrices</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Parallel</span>
</pre></div>
</div>
<p>As SOAP is a local descriptor, it also takes as input a list of atomic indices
or positions. If no such positions are defined, SOAP will be created for each
atom in the system. The call syntax for the create-method is as follows:</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">SOAP.</span></span><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_physical_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dscribe/descriptors/soap.html#SOAP.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the SOAP output for the given systems and given positions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>system</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ase.Atoms</span></code> or list of <code class="xref py py-class docutils literal notranslate"><span class="pre">ase.Atoms</span></code>) – One or
many atomic structures.</p></li>
<li><p><strong>positions</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a>) – Positions where to calculate SOAP. Can be
provided as cartesian positions or atomic indices. If no
positions are defined, the SOAP output will be created for all
atoms in the system. When calculating SOAP for multiple
systems, provide the positions as a list for each system.</p></li>
<li><p><strong>n_jobs</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – Number of parallel jobs to instantiate. Parallellizes
the calculation across samples. Defaults to serial calculation
with n_jobs=1. If a negative number is given, the used cpus
will be calculated with, n_cpus + n_jobs, where n_cpus is the
amount of CPUs as reported by the OS. With only_physical_cores
you can control which types of CPUs are counted in n_cpus.</p></li>
<li><p><strong>only_physical_cores</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – If a negative n_jobs is given,
determines which types of CPUs are used in calculating the
number of jobs. If set to False (default), also virtual CPUs
are counted.  If set to True, only physical CPUs are counted.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><em>bool</em></a>) – Controls whether to print the progress of each job
into to the console.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The SOAP output for the given systems and
positions. The return type depends on the ‘sparse’-attribute. The
first dimension is determined by the amount of positions and
systems and the second dimension is determined by the
get_number_of_features()-function. When multiple systems are
provided the results are ordered by the input order of systems and
their positions.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray | sparse.COO</p>
</dd>
</dl>
</dd></dl>

<p>The output will in this case be a numpy array with shape [#positions,
#features]. The number of features may be requested beforehand with the
<a class="reference internal" href="../../doc/dscribe.descriptors.html#dscribe.descriptors.soap.SOAP.get_number_of_features" title="dscribe.descriptors.soap.SOAP.get_number_of_features"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_number_of_features()</span></code></a>-method.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<p>The following examples demonstrate common use cases for the descriptor. These
examples are also available in dscribe/examples/soap.py.</p>
<div class="section" id="finite-systems">
<h3>Finite systems<a class="headerlink" href="#finite-systems" title="Permalink to this heading"></a></h3>
<p>Adding SOAP to water is as easy as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">molecule</span>

<span class="c1"># Molecule created as an ASE.Atoms</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s2">&quot;H2O&quot;</span><span class="p">)</span>

<span class="c1"># Create SOAP output for the system</span>
<span class="n">soap_water</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">soap_water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">soap_water</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>We are expecting a matrix where each row represents the local environment of
one atom of the molecule. The length of the feature vector depends on the
number of species defined in <em>species</em> as well as <em>nmax</em> and <em>lmax</em>. You can
try by changing <em>nmax</em> and <em>lmax</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets change the SOAP setup and see how the number of features changes</span>
<span class="n">small_soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">l_max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">big_soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">l_max</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">n_feat1</span> <span class="o">=</span> <span class="n">small_soap</span><span class="o">.</span><span class="n">get_number_of_features</span><span class="p">()</span>
<span class="n">n_feat2</span> <span class="o">=</span> <span class="n">big_soap</span><span class="o">.</span><span class="n">get_number_of_features</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_feat1</span><span class="p">,</span> <span class="n">n_feat2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="periodic-systems">
<h3>Periodic systems<a class="headerlink" href="#periodic-systems" title="Permalink to this heading"></a></h3>
<p>Crystals can also be SOAPed by simply setting <code class="code docutils literal notranslate"><span class="pre">periodic=True</span></code> in the SOAP
constructor and ensuring that the <code class="code docutils literal notranslate"><span class="pre">ase.Atoms</span></code> objects have a unit cell
and their periodic boundary conditions are set with the <code class="code docutils literal notranslate"><span class="pre">pbc</span></code>-option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>

<span class="n">copper</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;fcc&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">copper</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">())</span>
<span class="n">periodic_soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span>
    <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span>
    <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span>
    <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">l_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">soap_copper</span> <span class="o">=</span> <span class="n">periodic_soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">copper</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">soap_copper</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">soap_copper</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Since the SOAP feature vectors of each of the four copper atoms in the cubic
unit cell match, they turn out to be equivalent.</p>
</div>
<div class="section" id="weighting">
<span id="soap-weighting"></span><h3>Weighting<a class="headerlink" href="#weighting" title="Permalink to this heading"></a></h3>
<p>The default SOAP formalism weights the atomic density equally no matter how far
it is from the the position of interest. Especially in systems with uniform
atomic density this can lead to the atoms in farther away regions
dominating the SOAP spectrum. It has been shown <span id="id5">[<a class="reference internal" href="#id16" title="Michael J. Willatt, Félix Musil, and Michele Ceriotti. Feature optimization for atomistic machine learning yields a data-driven construction of the periodic table of the elements. Phys. Chem. Chem. Phys., 20:29661-29668, 2018. doi:10.1039/C8CP05921G.">4</a>]</span> that radially
scaling the atomic density can help in creating a suitable balance that gives
more importance to the closer-by atoms. This idea is very similar to the
weighting done in the MBTR descriptor.</p>
<p>The weighting could be done by directly adding a weighting function
<span class="math notranslate nohighlight">\(w(r)\)</span> in the integrals:</p>
<div class="math notranslate nohighlight">
\[c^Z_{nlm} =\iiint_{\mathcal{R}^3}\mathrm{d}V g_{n}(r)Y_{lm}(\theta, \phi)w(r)\rho^Z(\mathbf{r}).\]</div>
<p>This can, however, complicate the calculation of these integrals considerably.
Instead of directly weighting the atomic density, we can weight the
contribution of individual atoms by scaling the amplitude of their Gaussian
contributions:</p>
<div class="math notranslate nohighlight">
\[\rho^Z(\mathbf{r}) = \sum_i^{\lvert Z_i \rvert} w(\lvert \mathbf{R}_i \rvert)e^{-1/2\sigma^2 \lvert \mathbf{r} - \mathbf{R}_i \rvert^2}\]</div>
<p>This approximates the “correct” weighting very well as long as the width of the
atomic Gaussians (as determined by <code class="docutils literal notranslate"><span class="pre">sigma</span></code>) is small compared to the
variation in the weighting function <span class="math notranslate nohighlight">\(w(r)\)</span>.</p>
<p>DScribe currently supports this latter simplified weighting, with different
weighting functions, and a possibility to also separately weight the central
atom (sometimes the central atom will not contribute meaningful information and
you may wish to even leave it out completely by setting <code class="code docutils literal notranslate"><span class="pre">w0=0</span></code>). Three
different weighting functions are currently supported, and some example
instances from these functions are plotted below.</p>
<div class="figure align-center" id="id20">
<a class="reference internal image-reference" href="../../_images/soap_weighting.png"><img alt="SOAP weighting" src="../../_images/soap_weighting.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Example instances of weighting functions defined on the interval [0, 1]. The
<code class="docutils literal notranslate"><span class="pre">poly</span></code> function decays exactly to zero at <span class="math notranslate nohighlight">\(r=r_0\)</span>, the others
decay smoothly towards zero.</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</div>
<p>When using a weighting function, you typically will also want to restrict
<code class="docutils literal notranslate"><span class="pre">r_cut</span></code> into a range that lies within the domain in which your weighting
function is active. You can achieve this by manually tuning r_cut to a range
that fits your weighting function, or if you set <code class="code docutils literal notranslate"><span class="pre">r_cut=None</span></code>, it will be
set automatically into a sensible range which depends on your weighting
function. You can see more details and the algebraic form of the weighting
functions in the constructor documentation.</p>
</div>
<div class="section" id="locating-information">
<h3>Locating information<a class="headerlink" href="#locating-information" title="Permalink to this heading"></a></h3>
<p>The SOAP class provides the <a class="reference internal" href="../../doc/dscribe.descriptors.html#dscribe.descriptors.soap.SOAP.get_location" title="dscribe.descriptors.soap.SOAP.get_location"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_location()</span></code></a>-method. This method can
be used to query for the slice that contains a specific element combination.
The following example demonstrates its usage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The locations of specific element combinations can be retrieved like this.</span>
<span class="n">hh_loc</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">get_location</span><span class="p">((</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">))</span>
<span class="n">ho_loc</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">get_location</span><span class="p">((</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">))</span>

<span class="c1"># These locations can be directly used to slice the corresponding part from an</span>
<span class="c1"># SOAP output for e.g. plotting.</span>
<span class="n">soap_water</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">hh_loc</span><span class="p">]</span>
<span class="n">soap_water</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ho_loc</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="sparse-output">
<h3>Sparse output<a class="headerlink" href="#sparse-output" title="Permalink to this heading"></a></h3>
<p>For more information on the reasoning behind sparse output and its usage check
our separate <a class="reference internal" href="../sparse.html"><span class="doc">documentation on sparse output</span></a>.
Enabling sparse output on SOAP is as easy as setting <code class="code docutils literal notranslate"><span class="pre">sparse=True</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span>
    <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
    <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span>
    <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">l_max</span><span class="o">=</span><span class="n">l_max</span><span class="p">,</span>
    <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">soap_water</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">soap_water</span><span class="p">))</span>

<span class="n">soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span>
    <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
    <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span>
    <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">l_max</span><span class="o">=</span><span class="n">l_max</span><span class="p">,</span>
    <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">soap_water</span> <span class="o">=</span> <span class="n">soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">soap_water</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="average-output">
<h3>Average output<a class="headerlink" href="#average-output" title="Permalink to this heading"></a></h3>
<p>One way of turning a local descriptor into a global descriptor is simply by
taking the average over all sites. DScribe supports two averaging modes:
<em>inner</em> and <em>outer</em>. The inner average is taken over the sites before summing
up the magnetic quantum number. Outer averaging instead averages over the
power spectrum of individual sites. In general, the inner averaging will
preserve the configurational information better but you can experiment with
both versions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">average_soap</span> <span class="o">=</span> <span class="n">SOAP</span><span class="p">(</span>
    <span class="n">species</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
    <span class="n">r_cut</span><span class="o">=</span><span class="n">r_cut</span><span class="p">,</span>
    <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">,</span>
    <span class="n">l_max</span><span class="o">=</span><span class="n">l_max</span><span class="p">,</span>
    <span class="n">average</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
    <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">soap_water</span> <span class="o">=</span> <span class="n">average_soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average SOAP water: &quot;</span><span class="p">,</span> <span class="n">soap_water</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">methanol</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s1">&#39;CH3OH&#39;</span><span class="p">)</span>
<span class="n">soap_methanol</span> <span class="o">=</span> <span class="n">average_soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">methanol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average SOAP methanol: &quot;</span><span class="p">,</span> <span class="n">soap_methanol</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">h2o2</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s1">&#39;H2O2&#39;</span><span class="p">)</span>
<span class="n">soap_peroxide</span> <span class="o">=</span> <span class="n">average_soap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">h2o2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average SOAP peroxide: &quot;</span><span class="p">,</span> <span class="n">soap_peroxide</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>The result will be a feature vector and not a matrix, so it no longer depends
on the system size. This is necessary to compare two or more structures with
different number of elements. We can do so by e.g. applying the distance metric
of our choice.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">pdist</span><span class="p">,</span> <span class="n">squareform</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">molecules</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">soap_water</span><span class="p">,</span> <span class="n">soap_methanol</span><span class="p">,</span> <span class="n">soap_peroxide</span><span class="p">])</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="n">molecules</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Distance matrix: water - methanol - peroxide: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
</pre></div>
</div>
<p>It seems that the local environments of water and hydrogen peroxide are more
similar to each other. To see more advanced methods for comparing structures of
different sizes with each other, see the <a class="reference internal" href="../similarity_analysis/kernels.html"><span class="doc">kernel building tutorial</span></a>. Notice that simply averaging the SOAP vector does not always
correspond to the Average Kernel discussed in the kernel building tutorial, as
for non-linear kernels the order of kernel calculation and averaging matters.</p>
<div class="docutils container" id="id6">
<dl class="citation">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Sandip De, Albert P. Bartók, Gábor Csányi, and Michele Ceriotti. Comparing molecules and solids across structural and alchemical space. <em>Physical Chemistry Chemical Physics</em>, 18(20):13754–13769, 2016. <a class="reference external" href="https://doi.org/10.1039/c6cp00415f">doi:10.1039/c6cp00415f</a>.</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Marc O J Jäger, Eiaki V Morooka, Filippo Federici Canova, Lauri Himanen, and Adam S Foster. Machine learning hydrogen adsorption on nanoclusters through structural descriptors. <em>npj Computational Materials</em>, 2018. <a class="reference external" href="https://doi.org/10.1038/s41524-018-0096-5">doi:10.1038/s41524-018-0096-5</a>.</p>
</dd>
<dt class="label" id="id7"><span class="brackets">3</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>Albert P. Bartók, Risi Kondor, and Gábor Csányi. On representing chemical environments. <em>Physical Review B - Condensed Matter and Materials Physics</em>, 87(18):1–16, 2013. <a class="reference external" href="https://doi.org/10.1103/PhysRevB.87.184115">doi:10.1103/PhysRevB.87.184115</a>.</p>
</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Michael J. Willatt, Félix Musil, and Michele Ceriotti. Feature optimization for atomistic machine learning yields a data-driven construction of the periodic table of the elements. <em>Phys. Chem. Chem. Phys.</em>, 20:29661–29668, 2018. <a class="reference external" href="https://doi.org/10.1039/C8CP05921G">doi:10.1039/C8CP05921G</a>.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="acsf.html" class="btn btn-neutral float-left" title="Atom-centered Symmetry Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mbtr.html" class="btn btn-neutral float-right" title="Many-body Tensor Representation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions</span>
      v: 2.0.x
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="version-table">
        <dt>Versions</dt>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>