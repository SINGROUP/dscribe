<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coloring by Environment &mdash; DScribe 1.2.x documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="../../_static/js/versions.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Building similarity kernels from local environments" href="../similarity_analysis/kernels.html" />
    <link rel="prev" title="Unsupervised Learning: Clustering" href="../machine_learning/clustering.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2.x
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#descriptors">Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#machine-learning">Machine Learning</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#visualization">Visualization</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Coloring by Environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#references-and-final-system">References and final system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#colouring">Colouring</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#similarity-analysis">Similarity Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citing.html">Citing DScribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DScribe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
      <li>Coloring by Environment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/visualization/coloring_by_environment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="coloring-by-environment">
<h1>Coloring by Environment<a class="headerlink" href="#coloring-by-environment" title="Permalink to this heading"></a></h1>
<p>This tutorial demonstrates how one can visualize the abstract descriptor feature
space by mapping it into a visual property. The goal is to give a rough idea on
how to achieve this in a fairly easy scenario where the interesting structural
parts are already known and the system does not contain very many different
phases of interest. In principle the same technique can however be applied to
much more complicated scenarios by using clustering to automatically determine
the reference structures and by mapping reference landmarks in the descriptor
space into any combination of different visual properties, e.g. fill color,
opacity, outline color, size etc.</p>
<div class="section" id="references-and-final-system">
<h2>References and final system<a class="headerlink" href="#references-and-final-system" title="Permalink to this heading"></a></h2>
<p>We start out by creating bulk systems for two different iron phases: one for
BCC and another for FCC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">ase.io</span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span> <span class="nn">dscribe.descriptors</span> <span class="kn">import</span> <span class="n">LMBTR</span>

<span class="c1"># Lets create iron in BCC phase</span>
<span class="n">n_z</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">n_xy_bcc</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">a_bcc</span> <span class="o">=</span> <span class="mf">2.866</span>
<span class="n">bcc</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="s2">&quot;bcc&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_bcc</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">n_xy_bcc</span><span class="p">,</span> <span class="n">n_xy_bcc</span><span class="p">,</span> <span class="n">n_z</span><span class="p">]</span>

<span class="c1"># Lets create iron in FCC phase</span>
<span class="n">a_fcc</span> <span class="o">=</span> <span class="mf">3.5825</span>
<span class="n">n_xy_fcc</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">fcc</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_fcc</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">n_xy_fcc</span><span class="p">,</span> <span class="n">n_xy_fcc</span><span class="p">,</span> <span class="n">n_z</span><span class="p">]</span>
</pre></div>
</div>
<p>Since we know the phases we are looking for a priori, we can simply calculate
the reference descriptors for these two environments directly. Here we are using
the LMBTR descriptor, but any local descriptor would do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting up the descriptor</span>
<span class="n">descriptor</span> <span class="o">=</span> <span class="n">LMBTR</span><span class="p">(</span>
    <span class="n">k2</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;distance&quot;</span><span class="p">},</span>
        <span class="s2">&quot;weighting&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Fe&quot;</span><span class="p">],</span>
    <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Calculate feature references</span>
<span class="n">bcc_features</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">bcc</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fcc_features</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">fcc</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>In the more interesting case where the phases are not known in advance, one
could perform some form of clustering (see the <a class="reference internal" href="../machine_learning/clustering.html"><span class="doc">tutorial on clustering</span></a>) to
automatically find out meaningful reference structures from the data itself.
Next we create a larger system that contains these two grains:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine into one large grain boundary system with some added noise</span>
<span class="n">bcc</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_z</span> <span class="o">*</span> <span class="n">a_fcc</span><span class="p">])</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">bcc</span> <span class="o">+</span> <span class="n">fcc</span>
<span class="n">combined</span><span class="o">.</span><span class="n">set_cell</span><span class="p">([</span>
    <span class="n">n_xy_bcc</span> <span class="o">*</span> <span class="n">a_bcc</span><span class="p">,</span>
    <span class="n">n_xy_bcc</span> <span class="o">*</span> <span class="n">a_bcc</span><span class="p">,</span>
    <span class="n">n_z</span> <span class="o">*</span> <span class="p">(</span><span class="n">a_bcc</span> <span class="o">+</span> <span class="n">a_fcc</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">combined</span><span class="o">.</span><span class="n">rattle</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>The full structure will look like this:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/original.png"><img alt="FCC(111) surface" src="../../_images/original.png" style="width: 50%;" /></a>
</div>
</div>
<div class="section" id="colouring">
<h2>Colouring<a class="headerlink" href="#colouring" title="Permalink to this heading"></a></h2>
<p>Next we want to generate a simple metric that measures how similar the
environment of each atom is to the reference FCC and BCC structures. In this
example we define the metric as the Euclidean distance that is scaled to be
between 0 and 1 from least similar to identical with reference:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a measure of of how similar the atoms are to the reference. Euclidean</span>
<span class="c1"># distance is used and the values are scaled between 0 and 1 from least similar</span>
<span class="c1"># to identical with reference.</span>
<span class="k">def</span> <span class="nf">metric</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">reference</span><span class="p">):</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">reference</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dist_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
    <span class="k">return</span>  <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="n">dist_max</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we calculate the metrics for all atoms in the system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the features and metrics for all atoms in the sample.</span>
<span class="n">combined_features</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
<span class="n">fcc_metric</span> <span class="o">=</span> <span class="n">metric</span><span class="p">(</span><span class="n">combined_features</span><span class="p">,</span> <span class="n">fcc_features</span><span class="p">)</span>
<span class="n">bcc_metric</span> <span class="o">=</span> <span class="n">metric</span><span class="p">(</span><span class="n">combined_features</span><span class="p">,</span> <span class="n">bcc_features</span><span class="p">)</span>
</pre></div>
</div>
<p>The last step is to create a figure where our custom metric is mapped into
colors. We can create an image where the BCC-metric is tied to the blue color,
and FCC is tied to red:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write an image with the atoms coloured corresponding to their similarity with</span>
<span class="c1"># BCC and FCC: BCC = blue, FCC = red</span>
<span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_atoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
    <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">fcc_metric</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bcc_metric</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;coloured.png&#39;</span><span class="p">,</span>
    <span class="n">combined</span><span class="p">,</span>
    <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;90x,20y,20x&#39;</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
    <span class="n">show_unit_cell</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">maxwidth</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The final re-colored system looks like this:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/colored.png"><img alt="FCC(111) surface" src="../../_images/colored.png" style="width: 50%;" /></a>
</div>
<p>In addition to being able to clearly separate the two grains, one can see
imperfections as noise in the coloring and also how the interfaces affect the
metric both at the FCC/BCC interface and at the vacuum interface.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../machine_learning/clustering.html" class="btn btn-neutral float-left" title="Unsupervised Learning: Clustering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../similarity_analysis/kernels.html" class="btn btn-neutral float-right" title="Building similarity kernels from local environments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions</span>
      v: 1.2.x
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="version-table">
        <dt>Versions</dt>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>